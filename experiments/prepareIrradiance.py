# This script prepares irradiances generated by NEUVAC in preparation for comparison to other sources. Those other
# sources include: EUVAC, HEUVAC, FISM1, FISM2, and TIMED/SEE.

#-----------------------------------------------------------------------------------------------------------------------
# Top-level Imports
import numpy as np
import os
import matplotlib
matplotlib.use('Qt5Agg')
import matplotlib.pyplot as plt
#-----------------------------------------------------------------------------------------------------------------------

#-----------------------------------------------------------------------------------------------------------------------
# Local Imports
from NEUVAC.src import neuvac
from empiricalModels.models.EUVAC import euvac
from empiricalModels.models.HEUVAC import heuvac
from tools.EUV.fism2_process import read_euv_csv_file
from tools.processIrradiances import obtainFism1
from tools.processIrradiances import obtainFism2
from tools.processIrradiances import obtainSEE, rebinSEE
from tools.processIrradiances import obtainNRLSSIS2, rebinNRL
from tools import toolbox #, spectralAnalysis
#-----------------------------------------------------------------------------------------------------------------------

#-----------------------------------------------------------------------------------------------------------------------
# Directory Management
figures_directory = 'Figures/'
results_directory = 'Results/'
fism1_spectra_folder = '../empiricalModels/irradiances/FISM1/'
fism2_spectra_folder = '../empiricalModels/irradiances/FISM2/'
euv_folder = '../tools/EUV/'
#-----------------------------------------------------------------------------------------------------------------------

#-----------------------------------------------------------------------------------------------------------------------
# Execution
if __name__=="__main__":
    # Load in F10.7 data:
    timesData = '../solarIndices/F107/F107times.pkl'
    F107Data = '../solarIndices/F107/F107vals.pkl'
    F107AveData = '../solarIndices/F107/F107averageVals.pkl'
    times = toolbox.loadPickle(timesData)
    F107 = toolbox.loadPickle(F107Data)
    F107A = toolbox.loadPickle(F107AveData)
    # F10.7 data extends between 1947-02-14; 12:00 to 2008-02-03; 12:00.

    # NEUVAC Results:
    neuvacRes = neuvac.neuvacEUV(F107, F107A)

    # EUVAC Results:
    euvacRes = euvac.euvac(F107, F107A)

    # HEUVAC Results:
    heuvacRes = heuvac.heuvac(F107, F107A)

    # FISM1 Results:
    euv_data_59 = read_euv_csv_file(euv_folder + 'euv_59.csv', band=False)
    myFism1Files = os.listdir(fism1_spectra_folder)
    myTimesFISM1, myIrradianceFISM1 = obtainFism1(myFism1Files, euv_data_59, saveLoc=fism1_spectra_folder)
    # FISM1 data extends between 1990-01-01; 00:00 and 2018-04-10; 00:00.

    # FISM2 Results:
    fism2file = '../empiricalModels/irradiances/FISM2/daily_data_1947-2023.nc'
    myIrrTimesFISM2, myIrrDataAllFISM2, myIrrUncAllFISM2 = obtainFism2(fism2file, euv_data_59, saveLoc=fism2_spectra_folder)
    # FISM2 data extends between 1947-02-14; 00:00 and 2023-08-29; 00:00.

    # NRLSSI2 Results:
    NRLFile = '../empiricalModels/irradiances/NRLSSI2/ssi_v02r01_daily_s18820101_e20221231_c20230123.nc'
    datetimesNRL, wavelengthsNRL, bandwidthsNRL, irradiancesNRL, uncertaintiesNRL = obtainNRLSSIS2(NRLFile)
    rebinnedNRLData = rebinNRL(irradiancesNRL, euv_data_59, wavelengthsNRL, bandwidthsNRL)

    # TODO: INCLUDE SOLAR2000 Results.

    # TIMED/SEE Data:
    seeFile = '../measurements/TIMED_SEE_Level_3/see_L3_merged_1947-2023.ncdf'
    myIrrTimesSEE, mySEEWavelengths, myIrrDataAllSEE, myIrrUncAllSEE = obtainSEE(seeFile)
    rebinnedIrrData = rebinSEE(myIrrDataAllSEE, euv_data_59)
    # TIMED/SEE data extends between 2002-01-22;12:00 and 2023-08-27; 12:00.

    # TODO: Perform the necessary conversions between spectral FLUX and spectral IRRADIANCE.

    print('Data preparation complete.')
#-----------------------------------------------------------------------------------------------------------------------
